{
  "schema_version": "gatekeeper-artifact-v1.0",
  "timestamp": "2026-01-28T20:28:38.510486+00:00",
  "filepath": "/Users/frank/projects/claude-code-judge/migrations/migration_base.py",
  "mode": "repair-dry-run",
  "profile": "strict",
  "summary": {
    "initial_failure_count": 2,
    "final_failure_count": 1,
    "iterations_used": 2,
    "repair_confidence": 0.5,
    "improved": true,
    "fully_repaired": false
  },
  "failures": {
    "initial": [
      "Line 67: Function missing docstring",
      "Line 71: Function missing docstring"
    ],
    "final": [
      "Line 72: Function missing docstring"
    ]
  },
  "iterations": [
    {
      "iteration": 1,
      "failures_before": 2,
      "repairs_proposed": 2,
      "repairs": [
        {
          "line": 67,
          "old": "    def __init__(self, log_dir: Path = Path(\".gatekeeper/migrations\")):",
          "new": "    def __init__(self, log_dir: Path = Path(\".gatekeeper/migrations\")):\n        \"\"\"Initialize migration log with specified directory.\"\"\"",
          "reason": "Function missing docstring",
          "category": "docstring",
          "blocking": true
        },
        {
          "line": 71,
          "old": "    def record_migration(",
          "new": "    def record_migration(",
          "reason": "Function missing docstring - already has docstring on line 78",
          "category": "docstring",
          "blocking": false
        }
      ]
    },
    {
      "iteration": 2,
      "failures_before": 1,
      "repairs_proposed": 1,
      "repairs": [
        {
          "line": 72,
          "old": "    def __init__(self, log_dir: Path = Path(\".gatekeeper/migrations\")):",
          "new": "    def __init__(self, log_dir: Path = Path(\".gatekeeper/migrations\")):\n        \"\"\"Initialize migration log with specified directory.\"\"\"",
          "reason": "Function missing docstring",
          "category": "docstring",
          "blocking": true
        }
      ]
    }
  ],
  "diff": {
    "before": "\"\"\"\nMigration Base \u2014 Schema Version Upgrade Framework\n\nProvides base classes and utilities for schema migrations.\n\"\"\"\n\nfrom abc import ABC, abstractmethod\nfrom typing import Dict, Optional\nfrom pathlib import Path\nimport json\nfrom datetime import datetime, timezone\n\n\nclass Migration(ABC):\n    \"\"\"Base class for all schema migrations.\"\"\"\n    \n    @property\n    @abstractmethod\n    def from_version(self) -> str:\n        \"\"\"Source schema version.\"\"\"\n        pass\n    \n    @property\n    @abstractmethod\n    def to_version(self) -> str:\n        \"\"\"Target schema version.\"\"\"\n        pass\n    \n    @abstractmethod\n    def migrate(self, artifact: Dict) -> Dict:\n        \"\"\"\n        Perform migration.\n        \n        Args:\n            artifact: Artifact in source schema\n        \n        Returns:\n            Artifact in target schema\n        \"\"\"\n        pass\n    \n    @abstractmethod\n    def rollback(self, artifact: Dict) -> Dict:\n        \"\"\"\n        Rollback migration (if possible).\n        \n        Args:\n            artifact: Artifact in target schema\n        \n        Returns:\n            Artifact in source schema\n        \"\"\"\n        pass\n    \n    def validate_source(self, artifact: Dict) -> bool:\n        \"\"\"Validate artifact is in expected source version.\"\"\"\n        return artifact.get(\"schema_version\") == self.from_version\n    \n    def validate_target(self, artifact: Dict) -> bool:\n        \"\"\"Validate artifact is in expected target version.\"\"\"\n        return artifact.get(\"schema_version\") == self.to_version\n\n\nclass MigrationLog:\n    \"\"\"Records all migrations performed.\"\"\"\n    \n    def __init__(self, log_dir: Path = Path(\".gatekeeper/migrations\")):\n        self.log_dir = log_dir\n        self.log_dir.mkdir(parents=True, exist_ok=True)\n    \n    def record_migration(\n        self,\n        artifact_path: Path,\n        from_version: str,\n        to_version: str,\n        success: bool,\n        error: Optional[str] = None\n    ) -> Path:\n        \"\"\"Record a migration operation.\"\"\"\n        \n        timestamp = datetime.now(timezone.utc).isoformat()\n        timestamp_short = datetime.now(timezone.utc).strftime(\"%Y%m%d_%H%M%S\")\n        \n        log_entry = {\n            \"timestamp\": timestamp,\n            \"artifact_path\": str(artifact_path),\n            \"from_version\": from_version,\n            \"to_version\": to_version,\n            \"success\": success,\n            \"error\": error\n        }\n        \n        log_filename = f\"{timestamp_short}_migration.json\"\n        log_path = self.log_dir / log_filename\n        \n        log_path.write_text(json.dumps(log_entry, indent=2))\n        return log_path\n    \n    def get_migration_history(self, artifact_path: Path) -> list[Dict]:\n        \"\"\"Get all migrations performed on a specific artifact.\"\"\"\n        history = []\n        \n        for log_file in sorted(self.log_dir.glob(\"*.json\")):\n            log_entry = json.loads(log_file.read_text())\n            if log_entry[\"artifact_path\"] == str(artifact_path):\n                history.append(log_entry)\n        \n        return history\n",
    "after": "\"\"\"\nMigration Base \u2014 Schema Version Upgrade Framework\n\nProvides base classes and utilities for schema migrations.\n\"\"\"\n\nfrom abc import ABC, abstractmethod\nfrom typing import Dict, Optional\nfrom pathlib import Path\nimport json\nfrom datetime import datetime, timezone\n\n\nclass Migration(ABC):\n    \"\"\"Base class for all schema migrations.\"\"\"\n    \n    @property\n    @abstractmethod\n    def from_version(self) -> str:\n        \"\"\"Source schema version.\"\"\"\n        pass\n    \n    @property\n    @abstractmethod\n    def to_version(self) -> str:\n        \"\"\"Target schema version.\"\"\"\n        pass\n    \n    @abstractmethod\n    def migrate(self, artifact: Dict) -> Dict:\n        \"\"\"\n        Perform migration.\n        \n        Args:\n            artifact: Artifact in source schema\n        \n        Returns:\n            Artifact in target schema\n        \"\"\"\n        pass\n    \n    @abstractmethod\n    def rollback(self, artifact: Dict) -> Dict:\n        \"\"\"\n        Rollback migration (if possible).\n        \n        Args:\n            artifact: Artifact in target schema\n        \n        Returns:\n            Artifact in source schema\n        \"\"\"\n        pass\n    \n    def validate_source(self, artifact: Dict) -> bool:\n        \"\"\"Validate artifact is in expected source version.\"\"\"\n        return artifact.get(\"schema_version\") == self.from_version\n    \n    def validate_target(self, artifact: Dict) -> bool:\n        \"\"\"Validate artifact is in expected target version.\"\"\"\n        return artifact.get(\"schema_version\") == self.to_version\n\n\nclass MigrationLog:\n    \"\"\"Records all migrations performed.\"\"\"\n    \n    def __init__(self, log_dir: Path = Path(\".gatekeeper/migrations\")):\n        \"\"\"Initialize migration log with specified directory.\"\"\"\n        self.log_dir = log_dir\n        self.log_dir.mkdir(parents=True, exist_ok=True)\n    \n    def record_migration(\n        self,\n        artifact_path: Path,\n        from_version: str,\n        to_version: str,\n        success: bool,\n        error: Optional[str] = None\n    ) -> Path:\n        \"\"\"Record a migration operation.\"\"\"\n        \n        timestamp = datetime.now(timezone.utc).isoformat()\n        timestamp_short = datetime.now(timezone.utc).strftime(\"%Y%m%d_%H%M%S\")\n        \n        log_entry = {\n            \"timestamp\": timestamp,\n            \"artifact_path\": str(artifact_path),\n            \"from_version\": from_version,\n            \"to_version\": to_version,\n            \"success\": success,\n            \"error\": error\n        }\n        \n        log_filename = f\"{timestamp_short}_migration.json\"\n        log_path = self.log_dir / log_filename\n        \n        log_path.write_text(json.dumps(log_entry, indent=2))\n        return log_path\n    \n    def get_migration_history(self, artifact_path: Path) -> list[Dict]:\n        \"\"\"Get all migrations performed on a specific artifact.\"\"\"\n        history = []\n        \n        for log_file in sorted(self.log_dir.glob(\"*.json\")):\n            log_entry = json.loads(log_file.read_text())\n            if log_entry[\"artifact_path\"] == str(artifact_path):\n                history.append(log_entry)\n        \n        return history\n"
  },
  "metadata": {
    "gatekeeper_version": "1.0.0",
    "created_at": "2026-01-28T20:28:38.510486+00:00"
  }
}